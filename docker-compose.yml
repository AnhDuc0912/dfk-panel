services:
  dfkpanel:
    build: .
    env_file:
      - .env
    ports:
      - "${PORT:-3333}:3333"
    # Environment variables are loaded from .env via `env_file` above.
    # They will be available inside the container automatically without listing them here.
    volumes:
      # Mount host folder to an absolute container path `/repos` so Docker bind mount is valid.
      # Set HOST_REPO_DIR to an absolute host path to control where host files are stored.
      # Default host path falls back to ./repos and is mounted to the container path `/repos`.
      - "${HOST_REPO_DIR:-./repos}:/repos:rw"
      # Optionally bind a host path for NGINX_SITES_DIR if you want the panel to write there.
      # To enable, set HOST_SITES_DIR in .env (e.g. /data/dfk-panel/sites-enabled) and
      # the following mount will bind that host path into the container.
      - "${HOST_SITES_DIR}:${NGINX_SITES_DIR:-/etc/nginx/sites-enabled}:rw"
    # Ensure the app uses the absolute container path for repositories
    environment:
      - ROOT_DIR=/repos
    user: "${UID:-1000}:${GID:-1000}"
    restart: unless-stopped
